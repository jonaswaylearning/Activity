<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Pronunciation Practice - Cobra Kai Phrases</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .intro {
            background-color: #e8f0fe;
            color: #1a73e8;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #d2e3fc;
            max-width: 600px;
            text-align: center;
            margin-bottom: 20px;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .slider-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            overflow: hidden;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 0 0 20px 0;
        }

        /* Top Header with Progress and Reset */
        .top-header {
            display: flex;
            align-items: center;
            background-color: #ecf0f1;
            height: 40px;
            padding: 0 10px;
            justify-content: space-between;
        }

        .progress-container {
            flex-grow: 1;
            background-color: #bdc3c7;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-right: 15px;
        }

        .progress-bar {
            height: 100%;
            background-color: #3498db;
            width: 0%;
            transition: width 0.3s ease;
        }

        .btn-reset {
            background: none;
            border: 1px solid #95a5a6;
            color: #7f8c8d;
            padding: 4px 8px;
            font-size: 0.8em;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-reset:hover {
            background-color: #95a5a6;
            color: white;
        }

        .slide-content {
            padding: 20px 20px 0 20px;
        }

        .slide {
            display: none;
            flex-direction: column;
            align-items: center;
            text-align: center;
            animation: fadeIn 0.5s;
        }

        .slide.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .english-text {
            font-size: 1.4em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .phonetic-text {
            font-size: 1.1em;
            color: #d35400;
            font-style: italic;
            margin-bottom: 8px;
        }

        .portuguese-text {
            font-size: 1em;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* 3-Stage Card Progress */
        .stage-wrapper {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            justify-content: center;
            width: 100%;
            max-width: 200px;
        }

        .stage-segment {
            flex: 1;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            transition: background-color 0.4s ease, transform 0.2s;
        }

        .stage-segment.completed {
            background-color: #27ae60;
            transform: scale(1.1);
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Specific Button Styles */
        .btn-play { background-color: #3498db; color: white; }
        .btn-play:hover { background-color: #2980b9; }

        .btn-slow { background-color: #f1c40f; color: #2c3e50; }
        .btn-slow:hover { background-color: #f39c12; }

        .btn-record { background-color: #e74c3c; color: white; }
        .btn-record:hover { background-color: #c0392b; }
        .btn-record.recording { animation: pulse 1.5s infinite; background-color: #c0392b; }

        .nav-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-top: 20px;
            border-top: 1px solid #eee;
            padding: 15px 20px 0 20px;
            box-sizing: border-box;
        }

        .btn-nav {
            background-color: #ecf0f1;
            color: #2c3e50;
        }
        .btn-nav:hover { background-color: #bdc3c7; }
        
        .counter {
            font-weight: bold;
            color: #7f8c8d;
        }

        .result {
            margin-top: 15px;
            font-weight: bold;
            min-height: 24px;
            text-align: center;
            padding: 0 20px;
        }

        .success { color: #27ae60; }
        .error { color: #c0392b; }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        footer {
            text-align: center;
            margin-top: 20px;
            color: #95a5a6;
            font-size: 0.8em;
        }
    </style>
</head>
<body>

    <div class="intro">
        Acesse o link pelo navegador Chrome. Clique em (‚ñ∂Ô∏è Play) para ouvir, em (üê¢ Slow) para ouvir mais lentamente e em (üî¥ Record) para treinar a sua pron√∫ncia. Repita cada item com no m√≠nimo 60% da pron√∫ncia correta, <strong>por tr√™s vezes</strong>.
    </div>

    <div class="slider-container">
        <div class="top-header">
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <button class="btn-reset" onclick="resetLesson()" title="Reset all progress">üîÑ Reset</button>
        </div>

        <div class="slide-content">
            <div id="slides-wrapper">
                </div>

            <div class="result" id="result-msg"></div>

            <div class="nav-controls">
                <button class="btn-nav" onclick="changeSlide(-1)">‚¨ÖÔ∏è Previous</button>
                <span class="counter" id="slide-counter">1 / 7</span>
                <button class="btn-nav" id="btn-next" onclick="changeSlide(1)">Next ‚û°Ô∏è</button>
            </div>
        </div>
    </div>

    <footer style="text-align: center; margin-top: 20px;">Created by Jonas Freitas Goes</footer>

    <script>
        // 10151401190618050920011907150519

        const sentences = [
            {
                en: "The only good thing here is that I don't have to talk to anybody.",
                pt: "A √∫nica coisa boa daqui √© que n√£o preciso falar com ningu√©m.",
                phonetic: "The √¥unli g√∫d thing r√≠rh iz th√©r√°ir√¥unt r√©v tchu t√≥k tchu √©nib√°ri."
            },
            {
                en: "You know what? I hated this damn job anyway.",
                pt: "Quer saber? Eu odiava esse trabalho mesmo.",
                phonetic: "Iu n√¥u u√°t? √Åi r√™ired this d√©m dj√≥b √©ni u√™i."
            },
            {
                en: "All right, you want my advice? Stop being so annoying.",
                pt: "Olha, quer um conselho? Deixe de ser t√£o irritante.",
                phonetic: "√ìl rh√°it, iu u√≥nt m√°i ad v√°is? St√≥p b√≠ ing s√¥u an √≥ ing."
            },
            {
                en: "God doesn't give people things He doesn't want 'em to use.",
                pt: "Deus n√£o d√° √†s pessoas coisas que Ele n√£o quer que usem.",
                phonetic: "G√≥d d√¢zent giv p√≠pol things R√≠ d√¢zent u√≥nt em tchu i√∫z."
            },
            {
                en: "All right. That's all water under the bridge.",
                pt: "√Åguas passadas n√£o movem moinhos.",
                phonetic: "√ìl rh√°it. Th√©ts √≥l u√≥rerh √¢nderh the bridj."
            },
            {
                en: "You know what? It‚Äôs on the house.",
                pt: "Quer saber? Por conta da casa.",
                phonetic: "Iu n√¥u u√°t? Its √≥n the r√°us."
            },
            {
                en: "I'm gonna teach you how to awaken the snake within you.",
                pt: "Vou te ensinar a despertar a cobra que existe dentro de voc√™.",
                phonetic: "√Åim g√¥na t√≠tch iu r√°ura a u√™i ken the sn√™ik uith√≠n iu."
            }
        ];

        let currentSlide = 0;
        let recognition;
        let isRecording = false;
        let slideProgress = new Array(sentences.length).fill(0);

        // Success Sound (Short Ding)
        const successSound = new Audio("data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAAAAAD/AAAAAAAA////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////7///3///1///z///x///v///t///r///p///nf//lP//jP//gv//dP//Zf//TP//KP//EP//AP//9f/86//z3//Lzf+wqv6Ujf1sbf1DTv0aL/38+v3f6/3Cz/2gqv19kP1Wav0uTP0HFv3u+P3O7f291f2fuP1/mP1ccf04Uf0VF/33/P3U8P2+2f2lwf2CnP1hdv09Vf0ZGf36/v3X8v3C3P2pxP2Fof1mev1BWv0dHP39/v3a9P3E3v2syP2Ip/1qfv1FXv0hH/3//f3c9f3G4P2uy/2Lqf1sYP1IYP0kIv0AAf7e9v3I4f2wzf2Nq/1uY/1LZf0nJP0DA/7g9/3K4v2xz/2OrP1vZP1NZv0pJv0FA/7h+P3L4/2yz/2PrP1wZf1OaP0qJ/0HBP7j+P3M5P200P2Qrf1xZ/1Pav0sKP0IBf7k+f3N5f210f2Rr/1yaP1Ra/0tKf0KBv7l+v3O5v220v2SsP1zaf1SbP0uKv0LB/7m+v3P5/230/2Tsf10av1Tbv0vK/0MCP7n+/3Q6P241P2Us/11a/1Ub/0wLP0NCP7o/P3R6f251f2VtP12bP1VcQNwLAAA");

        function init() {
            const wrapper = document.getElementById('slides-wrapper');
            sentences.forEach((item, index) => {
                const slide = document.createElement('div');
                slide.className = `slide ${index === 0 ? 'active' : ''}`;
                slide.innerHTML = `
                    <div class="english-text">${item.en}</div>
                    <div class="phonetic-text">${item.phonetic}</div>
                    <div class="portuguese-text">${item.pt}</div>
                    
                    <div class="stage-wrapper" id="stage-wrapper-${index}">
                        <div class="stage-segment"></div>
                        <div class="stage-segment"></div>
                        <div class="stage-segment"></div>
                    </div>

                    <div class="controls">
                        <button class="btn-play" onclick="playAudio('${item.en.replace(/'/g, "\\'")}', 1)">‚ñ∂Ô∏è Play</button>
                        <button class="btn-slow" onclick="playAudio('${item.en.replace(/'/g, "\\'")}', 0.5)">üê¢ Slow</button>
                        <button class="btn-record" id="rec-btn-${index}" onclick="toggleRecording(${index})">üî¥ Record</button>
                    </div>
                `;
                wrapper.appendChild(slide);
            });
            updateUI();
            setupSpeechRecognition();
        }

        function resetLesson() {
            if(confirm("Tem certeza que deseja reiniciar o progresso?")) {
                currentSlide = 0;
                slideProgress = new Array(sentences.length).fill(0);
                
                const slides = document.querySelectorAll('.slide');
                slides.forEach(s => s.classList.remove('active'));
                slides[0].classList.add('active');

                document.querySelectorAll('.stage-segment').forEach(seg => {
                    seg.classList.remove('completed');
                });

                document.getElementById('result-msg').textContent = "";
                document.getElementById('result-msg').className = "result";
                
                speechSynthesis.cancel();
                if(isRecording) stopRecording(0); 
                
                updateUI();
            }
        }

        function changeSlide(direction) {
            const slides = document.querySelectorAll('.slide');
            
            slides[currentSlide].classList.remove('active');
            
            speechSynthesis.cancel();
            if (isRecording) stopRecording(currentSlide);

            currentSlide += direction;
            
            if (currentSlide < 0) currentSlide = slides.length - 1;
            if (currentSlide >= slides.length) currentSlide = 0;
            
            slides[currentSlide].classList.add('active');
            document.getElementById('result-msg').textContent = "";
            document.getElementById('result-msg').className = "result";
            updateUI();
        }

        function updateUI() {
            document.getElementById('slide-counter').textContent = `${currentSlide + 1} / ${sentences.length}`;
            
            const progressPercentage = ((currentSlide + 1) / sentences.length) * 100;
            document.getElementById('progress-bar').style.width = `${progressPercentage}%`;
        }

        function updateStageVisuals(slideIndex) {
            const wrapper = document.getElementById(`stage-wrapper-${slideIndex}`);
            const segments = wrapper.querySelectorAll('.stage-segment');
            const score = slideProgress[slideIndex];
            
            segments.forEach((seg, i) => {
                if (i < score) {
                    seg.classList.add('completed');
                } else {
                    seg.classList.remove('completed');
                }
            });
        }

        function playAudio(text, rate) {
            if (isRecording) stopRecording(currentSlide);
            speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = rate;
            speechSynthesis.speak(utterance);
        }

        function setupSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.lang = 'en-US';
                recognition.interimResults = false;
                recognition.maxAlternatives = 1;

                recognition.onstart = () => {
                    isRecording = true;
                    document.getElementById(`rec-btn-${currentSlide}`).classList.add('recording');
                    document.getElementById('result-msg').textContent = "Listening...";
                    document.getElementById('result-msg').className = "result";
                };

                recognition.onend = () => {
                    isRecording = false;
                    const btn = document.getElementById(`rec-btn-${currentSlide}`);
                    if(btn) btn.classList.remove('recording');
                };

                recognition.onresult = (event) => {
                    const speechResult = event.results[0][0].transcript;
                    checkPronunciation(speechResult);
                };

                recognition.onerror = (event) => {
                    document.getElementById('result-msg').textContent = "Error: " + event.error;
                    isRecording = false;
                    document.getElementById(`rec-btn-${currentSlide}`).classList.remove('recording');
                };
            } else {
                alert("Seu navegador n√£o suporta reconhecimento de voz. Por favor, use o Google Chrome.");
            }
        }

        function toggleRecording(index) {
            speechSynthesis.cancel();
            if (isRecording) {
                stopRecording(index);
            } else {
                recognition.start();
            }
        }

        function stopRecording(index) {
            recognition.stop();
            isRecording = false;
            const btn = document.getElementById(`rec-btn-${index}`);
            if(btn) btn.classList.remove('recording');
        }

        function checkPronunciation(spokenText) {
            const targetText = sentences[currentSlide].en;
            const similarityScore = calculateSimilarity(spokenText.toLowerCase(), targetText.toLowerCase());
            
            const msgDiv = document.getElementById('result-msg');
            const percentage = Math.round(similarityScore * 100);

            if (similarityScore >= 0.6) {
                // PLAY SUCCESS SOUND
                successSound.currentTime = 0; // Reset sound to start
                successSound.play();

                if (slideProgress[currentSlide] < 3) {
                    slideProgress[currentSlide]++;
                    updateStageVisuals(currentSlide);
                }

                if (slideProgress[currentSlide] === 3) {
                    msgDiv.textContent = `üéâ Completed! You said: "${spokenText}" (${percentage}%)`;
                    msgDiv.className = "result success";
                } else {
                    msgDiv.textContent = `‚úÖ Good job! (${slideProgress[currentSlide]}/3) You said: "${spokenText}" (${percentage}%)`;
                    msgDiv.className = "result success";
                }

            } else {
                msgDiv.textContent = `‚ùå Try again. You said: "${spokenText}" (${percentage}%)`;
                msgDiv.className = "result error";
            }
        }

        // Levenshtein Distance Algorithm
        function calculateSimilarity(s1, s2) {
            s1 = s1.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").trim();
            s2 = s2.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").trim();

            let longer = s1;
            let shorter = s2;
            if (s1.length < s2.length) {
                longer = s2;
                shorter = s1;
            }
            const longerLength = longer.length;
            if (longerLength === 0) return 1.0;
            return (longerLength - editDistance(longer, shorter)) / parseFloat(longerLength);
        }

        function editDistance(s1, s2) {
            s1 = s1.toLowerCase();
            s2 = s2.toLowerCase();
            const costs = new Array();
            for (let i = 0; i <= s1.length; i++) {
                let lastValue = i;
                for (let j = 0; j <= s2.length; j++) {
                    if (i === 0)
                        costs[j] = j;
                    else {
                        if (j > 0) {
                            let newValue = costs[j - 1];
                            if (s1.charAt(i - 1) !== s2.charAt(j - 1))
                                newValue = Math.min(Math.min(newValue, lastValue), costs[j]) + 1;
                            costs[j - 1] = lastValue;
                            lastValue = newValue;
                        }
                    }
                }
                if (i > 0)
                    costs[s2.length] = lastValue;
            }
            return costs[s2.length];
        }

        init();
    </script>
</body>
</html>